# Feature Inventory (Phase 1)

기준 저장소: `/Users/taeksoojung/Desktop/RutineIQ`  
기준일: 2026-02-19  
범위: 사용자에게 노출되는 기능(웹 기준)

우선순위 기준:
- `P0`: 핵심 여정 중단, 데이터 손실, 인증 실패
- `P1`: 주요 UX 붕괴, 상태 불일치
- `P2`: 경미한 UI/카피 이슈

| Feature | Where it lives (route/screen/file) | Dependencies (API/DB/External) | Acceptance criteria (Given / When / Then) | Failure modes to test | Priority |
|---|---|---|---|---|---|
| 이메일 로그인/회원가입 | Route: `/login` File: `/Users/taeksoojung/Desktop/RutineIQ/apps/web/src/components/login-client.tsx` | Supabase Auth (`signInWithPassword`, `signUp`) | Given 유효한 이메일/비밀번호, When 로그인/가입, Then 세션 생성 후 `/app/insights` 접근 가능 | 401 잘못된 비번, 네트워크 타임아웃, Supabase env 누락, 중복 이메일 가입 | P0 |
| Google OAuth 로그인 | Route: `/login` File: `/Users/taeksoojung/Desktop/RutineIQ/apps/web/src/components/login-client.tsx` | Supabase Auth OAuth Google, Supabase Provider 설정 | Given Google provider 활성화, When Google 로그인 버튼 클릭, Then OAuth 완료 후 앱 복귀 | Provider 비활성, redirect URL 불일치, 인앱브라우저 `disallowed_useragent`, OAuth callback 실패 | P0 |
| 인앱브라우저 Google 차단 가이드 | Route: `/login` File: `/Users/taeksoojung/Desktop/RutineIQ/apps/web/src/components/login-client.tsx` | Browser UA detection + external browser open | Given 모바일 인앱브라우저, When Google 로그인 시도, Then 외부 브라우저 열기 안내 노출 | 인앱 탐지 오탐/미탐, 외부 열기 실패 | P1 |
| 비밀번호 재설정 | Route: `/reset-password` File: `/Users/taeksoojung/Desktop/RutineIQ/apps/web/src/components/reset-password-client.tsx` | Supabase Auth (`updateUser`) | Given 유효한 복구 세션, When 새 비밀번호 입력, Then 비밀번호 변경 후 `/app/insights` 이동 | 세션 없음, 비밀번호 정책(8자), 비번 불일치, update 실패 | P1 |
| 앱 인증 게이트/리다이렉트 | Layout: `/app/*` File: `/Users/taeksoojung/Desktop/RutineIQ/apps/web/src/app/app/layout.tsx` | Supabase session check | Given 세션 없음, When `/app/*` 접근, Then `/login` 리다이렉트 | 세션 만료, auth 브리지 지연, SSR/CSR 불일치 | P0 |
| Daily Flow 일기 파싱 | Route: `/app/daily-flow` File: `/Users/taeksoojung/Desktop/RutineIQ/apps/web/src/app/app/daily-flow/page.tsx` | `POST /api/parse-diary`, OpenAI(서버), `activity_logs` | Given 10자 이상 일기, When AI 분석하기, Then 파싱 결과(활동 블록/메타)와 근거가 표시됨 | 502/timeout, schema invalid, 파싱 fallback, 근거 누락, 언어 처리 오류 | P0 |
| Daily Flow 확인/수정/저장 | Route: `/app/daily-flow` File: `/Users/taeksoojung/Desktop/RutineIQ/apps/web/src/app/app/daily-flow/page.tsx` | `POST /api/logs`, `GET /api/logs`, `activity_logs`, `profiles` | Given 파싱된 블록, When window 칩/시간 수정 후 저장, Then `/api/logs` 성공 및 재조회 시 동일 데이터 유지 | 409 conflict, RLS write 실패, timeout, 중복 클릭, 날짜 이동 중 draft 손실 | P0 |
| Daily Flow 저장 후 분석 이동 | Route: `/app/daily-flow` File: `/Users/taeksoojung/Desktop/RutineIQ/apps/web/src/app/app/daily-flow/page.tsx` | `POST /api/analyze`, `GET /api/reports`, `ai_reports` | Given 저장 완료, When AI 분석 버튼 클릭, Then 보고서 생성 후 `/app/reports/[date]` 이동 | analyze 429/502, 로그 없음, 리포트 생성 지연 | P0 |
| Insights 대시보드 로드 | Route: `/app/insights` File: `/Users/taeksoojung/Desktop/RutineIQ/apps/web/src/app/app/insights/page.tsx` | `/api/logs`, `/api/reports`, `/api/insights/weekly` | Given 로그인 상태, When 인사이트 진입, Then 오늘 상태/주간 지표/카드가 로드됨 | 특정 API 실패 시 전체 화면 블로킹, 무한 스피너, 부분 데이터 처리 실패 | P0 |
| Insights에서 AI 정리 실행 | Route: `/app/insights` File: `/Users/taeksoojung/Desktop/RutineIQ/apps/web/src/app/app/insights/page.tsx` | `POST /api/analyze`, `GET /api/reports` | Given 오늘 기록 존재, When AI로 정리하기, Then 코치/내일 일정 카드가 갱신됨 | analyze timeout, 캐시 stale, 보고서 파싱 오류 | P0 |
| 리포트 조회/빈 상태 처리 | Route: `/app/reports/[date]` File: `/Users/taeksoojung/Desktop/RutineIQ/apps/web/src/app/app/reports/[date]/page.tsx` | `GET /api/reports`, sessionStorage cache | Given 특정 날짜 리포트 없음, When 진입, Then 404는 에러가 아니라 empty state로 표시됨 | 404를 에러로 표시, background refresh 실패 시 기존 데이터 덮어쓰기 | P0 |
| 리포트 재생성(강제 분석) | Route: `/app/reports/[date]` File: `/Users/taeksoojung/Desktop/RutineIQ/apps/web/src/app/app/reports/[date]/page.tsx` | `POST /api/analyze` | Given 날짜 선택, When Analyze 클릭, Then 최신 리포트 재생성 | analyze 실패, 버튼 연타, 날짜 경계값 | P1 |
| 리포트 캘린더 내보내기 | Route: `/app/reports/[date]` File: `/Users/taeksoojung/Desktop/RutineIQ/apps/web/src/app/app/reports/[date]/page.tsx` | ICS 생성 유틸 `/Users/taeksoojung/Desktop/RutineIQ/apps/web/src/lib/ics.ts` | Given tomorrow_routine 존재, When 내보내기 클릭, Then `.ics` 다운로드 | routine 없음, 브라우저 download 차단, blob revoke timing | P1 |
| 코호트 트렌드 카드 | Route: `/app/insights` File: `/Users/taeksoojung/Desktop/RutineIQ/apps/web/src/app/app/insights/page.tsx` | `GET /api/trends/cohort`, `POST /api/trends/cohort/event`, `profiles`, `activity_logs` | Given 옵트인/표본 조건, When 카드 렌더, Then preview/정식 모드 규칙에 맞게 수치·배지·문구 노출 | 샘플 경계(19/20/49/50/99/100), rank/tip 비노출 규칙 위반, telemetry 실패 | P0 |
| 비교 기준 조정 진입 | Route: `/app/insights?settings=1&settingsTab=profile` File: `/Users/taeksoojung/Desktop/RutineIQ/apps/web/src/components/app-settings-panel.tsx` | URL param open + profile save API | Given 코호트 카드에서 설정 열기 클릭, When 클릭, Then 설정 패널 profile 탭이 열림 | 구 URL(`/app/preferences`)로 오이동, 모바일 동작 불일치 | P1 |
| 설정 패널: 알림 | Surface: FAB Settings modal File: `/Users/taeksoojung/Desktop/RutineIQ/apps/web/src/components/app-settings-panel.tsx` | Browser Notification API, Supabase auth metadata update | Given 설정 패널, When 알림 토글/시간 저장, Then 사용자 메타데이터에 반영 | 브라우저 미지원, 권한 거부, 저장 실패 | P1 |
| 설정 패널: 개인설정(profile) | Surface: Settings modal profile tab File: `/Users/taeksoojung/Desktop/RutineIQ/apps/web/src/components/app-settings-panel.tsx` | `PUT /api/preferences/profile`, `GET /api/preferences/profile`, `profiles` | Given 필수 4항목 선택, When 저장, Then profile 저장되고 인사이트 비교 조건에 반영됨 | unknown 값 저장 시 검증 실패, RLS write 실패, enum 불일치 | P0 |
| 설정 패널: 데이터 초기화 | Surface: Settings modal data tab File: `/Users/taeksoojung/Desktop/RutineIQ/apps/web/src/components/app-settings-panel.tsx` | `DELETE /api/preferences/data`, `activity_logs`, `ai_reports` | Given 사용자 확인, When 데이터 초기화, Then 로그/리포트 삭제 | 확인창 우회, 삭제 실패, 삭제 후 stale cache | P1 |
| 설정 패널: 계정/플랜/업그레이드 | Surface: Settings modal account tab File: `/Users/taeksoojung/Desktop/RutineIQ/apps/web/src/components/app-settings-panel.tsx` + `/Users/taeksoojung/Desktop/RutineIQ/apps/web/src/components/billing-actions.tsx` | `GET /api/stripe/status`, `POST /api/stripe/create-checkout-session`, `subscriptions`, Stripe | Given Free 사용자, When Start Pro 클릭, Then checkout URL로 이동(또는 미설정 안내) | billing env 미설정, 이메일 로그인 미완료, checkout 생성 실패 | P0 |
| 설정 패널: 회원탈퇴 | Surface: Settings modal account tab File: `/Users/taeksoojung/Desktop/RutineIQ/apps/web/src/components/app-settings-panel.tsx` | `DELETE /api/preferences/account`, Supabase Admin Auth delete, service role key | Given 확인 수락, When 회원탈퇴 클릭, Then 계정 삭제 후 `/login?deleted=1` 이동 | service role key 누락, auth admin 503/500, timeout, 모바일/PC 불일치 | P0 |
| Recovery 재시작 UI (플래그 기반) | Route: `/app/insights` File: `/Users/taeksoojung/Desktop/RutineIQ/apps/web/src/app/app/insights/page.tsx` | `GET /api/recovery/active`, `GET/POST /api/recovery/nudge*`, recovery tables | Given recovery flags ON, When open session/nudge 존재, Then 재시작 카드·ack 동작 | 플래그 OFF 시 404 처리, nudge ack 멱등성, cron 상태 의존 | P1 |
| Admin 대시보드(관리자 전용) | Route: `/admin` Files: `/Users/taeksoojung/Desktop/RutineIQ/apps/web/src/app/admin/layout.tsx`, `/Users/taeksoojung/Desktop/RutineIQ/apps/web/src/components/admin-dashboard.tsx` | `/api/admin/users`, `/api/admin/errors`, `/api/admin/users/{id}`, `/api/admin/sync-subscription/{id}`, `profiles/subscriptions/system_errors` | Given admin role, When 관리자 페이지 진입, Then 유저/오류 목록 조회 및 동기화 실행 가능 | role 우회 접근, API 403/500, 대량 데이터 로딩 지연 | P1 |
| 오프라인 페이지 | Route: `/offline` File: `/Users/taeksoojung/Desktop/RutineIQ/apps/web/src/app/offline/page.tsx` | PWA service worker (`/Users/taeksoojung/Desktop/RutineIQ/apps/web/public/sw.js`) | Given 네트워크 없음, When 오프라인 진입, Then 사용자 안내 페이지 표시 | SW 등록 실패, fallback 미동작 | P2 |

