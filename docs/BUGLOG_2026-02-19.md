# Bug Log (2026-02-19)

## BUG-2026-02-19-001

- Severity: P1
- Area: API static typing / release gate stability
- Status: Resolved

### Reproduction
1. `cd /Users/taeksoojung/Desktop/RutineIQ/apps/api`
2. `.venv/bin/python -m mypy app`

### Expected
- `mypy` clean pass (`Success: no issues found ...`)

### Actual
- 5 type errors reported:
  - `app/routes/recovery.py` missing-tables detail dict inferred as `dict[str, str]` then list value assignment conflict
  - `app/routes/preferences.py` dynamic kwargs for `httpx.delete` inferred as incompatible mapping types

### Root Cause Hypothesis
- `recovery.py`: local `detail` dict inference was too narrow (`str` values only), then `missing_tables: list[str]` assignment violated inferred type.
- `preferences.py`: `kwargs` inference narrowed to header-only structure; later `json` payload assignment and `**kwargs` forwarding clashed with `httpx` type stubs.

### Fix Plan (minimal change)
- Add explicit `dict[str, Any]` typing where mixed payload types are valid.
- Keep runtime behavior unchanged; only typing intent clarified.

### Applied Fix
- `/Users/taeksoojung/Desktop/RutineIQ/apps/api/app/routes/recovery.py`
  - preflight `detail` typed as `dict[str, Any]` at first assignment
  - removed duplicate re-annotation that triggered `no-redef`
- `/Users/taeksoojung/Desktop/RutineIQ/apps/api/app/routes/preferences.py`
  - imported `Any`
  - `_auth_delete` kwargs typed as `dict[str, Any]` to support optional JSON body safely

### Regression Prevention
- Existing release gate already includes `mypy` in `/Users/taeksoojung/Desktop/RutineIQ/scripts/release-verify.sh`.
- Verified by rerunning:
  - `.venv/bin/python -m mypy app` ✅
  - `./scripts/release-verify.sh` ✅

### Rollback Note
- Revert the two files above to previous commit state if unexpected behavior appears.
- Low functional risk: patch changes type annotations only, not endpoint logic/response contract.
